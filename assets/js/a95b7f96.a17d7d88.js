"use strict";(self.webpackChunkpcoin_website=self.webpackChunkpcoin_website||[]).push([[5998],{4137:function(e,n,t){t.d(n,{Zo:function(){return s},kt:function(){return m}});var o=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=o.createContext({}),u=function(e){var n=o.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},s=function(e){var n=u(e.components);return o.createElement(c.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},d=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),d=u(t),m=r,g=d["".concat(c,".").concat(m)]||d[m]||p[m]||i;return t?o.createElement(g,a(a({ref:n},s),{},{components:t})):o.createElement(g,a({ref:n},s))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,a=new Array(i);a[0]=d;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,a[1]=l;for(var u=2;u<i;u++)a[u]=t[u];return o.createElement.apply(null,a)}return o.createElement.apply(null,t)}d.displayName="MDXCreateElement"},4848:function(e,n,t){t.r(n),t.d(n,{assets:function(){return s},contentTitle:function(){return c},default:function(){return m},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return p}});var o=t(3117),r=t(102),i=(t(7294),t(4137)),a=["components"],l={title:"Troubleshooting"},c=void 0,u={unversionedId:"PcoinPay/Guide/LNbank/Troubleshooting",id:"PcoinPay/Guide/LNbank/Troubleshooting",title:"Troubleshooting",description:"Debugging connection problems",source:"@site/docs/PcoinPay/Guide/LNbank/Troubleshooting.md",sourceDirName:"PcoinPay/Guide/LNbank",slug:"/PcoinPay/Guide/LNbank/Troubleshooting",permalink:"/docs/PcoinPay/Guide/LNbank/Troubleshooting",draft:!1,editUrl:"https://github.com/pcoinproject/pcoin.dev/edit/master/docs/PcoinPay/Guide/LNbank/Troubleshooting.md",tags:[],version:"current",frontMatter:{title:"Troubleshooting"},sidebar:"tutorialSidebar",previous:{title:"LNDhub Compatibility",permalink:"/docs/PcoinPay/Guide/LNbank/LNDhub"},next:{title:"PodServer",permalink:"/docs/PcoinPay/Guide/PodServer"}},s={},p=[{value:"Debugging connection problems",id:"debugging-connection-problems",level:2},{value:"DNS problems",id:"dns-problems",level:3},{value:"For Cloudflare users",id:"for-cloudflare-users",level:3},{value:"Using cURL for debugging",id:"using-curl-for-debugging",level:3},{value:"Manual deployment",id:"manual-deployment",level:2}],d={toc:p};function m(e){var n=e.components,t=(0,r.Z)(e,a);return(0,i.kt)("wrapper",(0,o.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"debugging-connection-problems"},"Debugging connection problems"),(0,i.kt)("p",null,'On the Lightning node connection setting screen, switch to "Use custom node".\nThere you will find the LNbank connection string, which looks like this:'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"type=lnbank;server=https://mypcoinpay.com/;api-token=WALLET_ACCESS_KEY\n")),(0,i.kt)("p",null,'On that view you can also use the "Test connection" functionality.\nIf you encounter problems like "The Lightning node did not reply in a timely manner", it\'s most likely a DNS-related problem.'),(0,i.kt)("h3",{id:"dns-problems"},"DNS problems"),(0,i.kt)("p",null,"The server that PCOINPay is running on might not be able to resolve the domain (in this example ",(0,i.kt)("inlineCode",{parentName:"p"},"mypcoinpay.com"),") correctly."),(0,i.kt)("p",null,"Use the ping command to debug to the problem.\n",(0,i.kt)("inlineCode",{parentName:"p"},"ping mypcoinpay.com")," should point to the IP of your server:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ ping mypcoinpay.com\nPING mypcoinpay.com (XX.XX.XX.XX) 56(84) bytes of data.\n64 bytes from XX.XX.XX.XX (XX.XX.XX.XX): icmp_seq=1 ttl=52 time=263 ms\n")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"XX.XX.XX.XX")," should be the external IP of the server.\nIn case you don't know it, run the same command not from your server, but from you local computer \u2014 this should give you the public IP of ythe server.\nIt the server's DNS resolves the domain to a local IP, find out where that is defined (most likely in the ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/hosts")," file) and remove that mapping."),(0,i.kt)("h3",{id:"for-cloudflare-users"},"For Cloudflare users"),(0,i.kt)("p",null,"If you are using Cloudflare, check if changing the folowing settings makes a difference:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Disable the ",(0,i.kt)("a",{parentName:"li",href:"https://developers.cloudflare.com/bots/get-started/free/"},"Bot Fighter Mode")),(0,i.kt)("li",{parentName:"ul"},"Switch the ",(0,i.kt)("a",{parentName:"li",href:"https://developers.cloudflare.com/dns/manage-dns-records/reference/proxied-dns-records"},"Proxy Status"),' to "Proxied" instead of "DNS only"')),(0,i.kt)("h3",{id:"using-curl-for-debugging"},"Using cURL for debugging"),(0,i.kt)("p",null,"You can also try to access the LNbank node info via cURL, which gives you a verbose output of possible connection problems:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl -vvv \\\n  -H "Content-Type: application/json" \\\n  -H "Authorization: Bearer WALLET_ACCESS_KEY" \\\n  https://mypcoinpay.com/plugins/lnbank/api/lightning/info\n')),(0,i.kt)("p",null,"This command should return the connection details as well as a JSON response containing your Lightning node information."),(0,i.kt)("h2",{id:"manual-deployment"},"Manual deployment"),(0,i.kt)("p",null,"If you have deployed PCOINPay Server using the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.pcoinpayserver.org/Deployment/ManualDeploymentExtended/"},"manual deployment"),', you might encounter the "LNbank requires an internal Lightning node to be configured" message on the LNbank wallets overview page.'),(0,i.kt)("p",null,'In this case, make sure that you have configured the Lightning node you want to use as "internal node" using the ',(0,i.kt)("inlineCode",{parentName:"p"},"BTC.lightning")," setting in your ",(0,i.kt)("a",{parentName:"p",href:"../.../Deployment/ManualDeploymentExtended/#3-create-a-configuration-file"},"pcoinpay.config")," file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"BTC.lightning=type=lnd-rest;server=https://127.0.0.1:8080/;macaroonfilepath=/home/admin/.lnd/data/chain/bitcoin/mainnet/admin.macaroon\n")),(0,i.kt)("p",null,'See the "Use custom node" view on the Lightning node connection setting screen in PCOINPay Server for details on the connection string.'),(0,i.kt)("p",null,"You need to restart PCOINPay Server for the settings update to take effect."))}m.isMDXComponent=!0}}]);