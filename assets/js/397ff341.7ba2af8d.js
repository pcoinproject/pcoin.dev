"use strict";(self.webpackChunkpcoin_website=self.webpackChunkpcoin_website||[]).push([[4560],{4137:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),p=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(n),m=a,h=d["".concat(l,".").concat(m)]||d[m]||u[m]||r;return n?o.createElement(h,i(i({ref:t},c),{},{components:n})):o.createElement(h,i({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var p=2;p<r;p++)i[p]=n[p];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7212:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return u}});var o=n(3117),a=n(102),r=(n(7294),n(4137)),i=["components"],s={title:"OpenCart",sidebar_position:25,description:"How to integrate PCOINPay Server into your OpenCart store.",tags:["OpenCart","Plugin","eCommerce"]},l="OpenCart integration",p={unversionedId:"PcoinPay/Guide/OpenCart",id:"PcoinPay/Guide/OpenCart",title:"OpenCart",description:"How to integrate PCOINPay Server into your OpenCart store.",source:"@site/docs/PcoinPay/Guide/OpenCart.md",sourceDirName:"PcoinPay/Guide",slug:"/PcoinPay/Guide/OpenCart",permalink:"/docs/PcoinPay/Guide/OpenCart",draft:!1,editUrl:"https://github.com/pcoinproject/pcoin.dev/edit/master/docs/PcoinPay/Guide/OpenCart.md",tags:[{label:"OpenCart",permalink:"/docs/tags/open-cart"},{label:"Plugin",permalink:"/docs/tags/plugin"},{label:"eCommerce",permalink:"/docs/tags/e-commerce"}],version:"current",sidebarPosition:25,frontMatter:{title:"OpenCart",sidebar_position:25,description:"How to integrate PCOINPay Server into your OpenCart store.",tags:["OpenCart","Plugin","eCommerce"]},sidebar:"tutorialSidebar",previous:{title:"Prestashop",permalink:"/docs/PcoinPay/Guide/PrestaShop"},next:{title:"Shopware",permalink:"/docs/PcoinPay/Guide/Shopware"}},c={},u=[{value:"Requirements",id:"requirements",level:2},{value:"1. Install PCOINPay extension",id:"1-install-pcoinpay-extension",level:2},{value:"1.2 Install the extension",id:"12-install-the-extension",level:3},{value:"2. Connecting OpenCart and PCOINPay Server",id:"2-connecting-opencart-and-pcoinpay-server",level:2},{value:"2.1 Configure PCOINPay Server extension in OpenCart",id:"21-configure-pcoinpay-server-extension-in-opencart",level:3},{value:"2.2 Create an API key and configure permissions",id:"22-create-an-api-key-and-configure-permissions",level:3},{value:"3. Test the checkout",id:"3-test-the-checkout",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Enable debug mode",id:"enable-debug-mode",level:3},{value:"The order states do not update, although the invoice has been paid.",id:"the-order-states-do-not-update-although-the-invoice-has-been-paid",level:2}],d={toc:u};function m(e){var t=e.components,n=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"opencart-integration"},"OpenCart integration"),(0,r.kt)("p",null,"This document explains how ",(0,r.kt)("strong",{parentName:"p"},"to integrate PCOINPay Server into your OpenCart store"),". Supported are OpenCart 3 and 4."),(0,r.kt)("h2",{id:"requirements"},"Requirements"),(0,r.kt)("p",null,"Please ensure that you meet the following requirements before installing this extension."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"PHP version >= 7.4 for OpenCart 3; PHP >= 8.1 for OpenCart 4"),(0,r.kt)("li",{parentName:"ul"},"The curl, gd, intl, json, and mbstring PHP extensions are available"),(0,r.kt)("li",{parentName:"ul"},"A OpenCart 3/4 store (",(0,r.kt)("a",{parentName:"li",href:"https://www.opencart.com/index.php?route=cms/download"},"Download and installation instructions"),")"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"IMPORTANT:")," You have a PCOINPay Server version 2.x.x or later, either ",(0,r.kt)("a",{parentName:"li",href:"../Deployment/README.md"},"self-hosted")," or ",(0,r.kt)("a",{parentName:"li",href:"../Deployment/ThirdPartyHosting.md"},"hosted by a third-party")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/PcoinPay/Guide/RegisterAccount"},"You've a registered account on the instance")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/PcoinPay/Guide/CreateStore"},"You've got a PCOINPay store on the instance")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/PcoinPay/Guide/WalletSetup/"},"You've got a wallet connected to your store"))),(0,r.kt)("h2",{id:"1-install-pcoinpay-extension"},"1. Install PCOINPay extension"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/pcoinproject/opencart"},"GitHub Repository"))),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Download the latest PCOINPay extension from ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/pcoinproject/opencart/releases"},"Github")),(0,r.kt)("li",{parentName:"ol"},"Menu: Extensions -> Install"),(0,r.kt)("li",{parentName:"ol"},"Click the button ","[Upload]"," and upload the downloaded ",(0,r.kt)("inlineCode",{parentName:"li"},"pcoinpay.ocmod.zip"),'\nAfter uploading, you should see a notice "Success: You have modified extensions! "')),(0,r.kt)("h3",{id:"12-install-the-extension"},"1.2 Install the extension"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Menu: Extensions -> Extensions"),(0,r.kt)("li",{parentName:"ol"},'On the "Choose extension type" dropdown, select "Payment".'),(0,r.kt)("li",{parentName:"ol"},'On the "Action" column, click the green install button.'),(0,r.kt)("li",{parentName:"ol"},'You will see a notification " Success: You have modified payments!"')),(0,r.kt)("h2",{id:"2-connecting-opencart-and-pcoinpay-server"},"2. Connecting OpenCart and PCOINPay Server"),(0,r.kt)("p",null,"Please make sure to have a PCOINPay Server instance setup as described in the ",(0,r.kt)("a",{parentName:"p",href:"#requirements"},"requirements")," above."),(0,r.kt)("p",null,"PCOINPay for OpenCart extension is a ",(0,r.kt)("strong",{parentName:"p"},"bridge between your PCOINPay Server (payment processor) and your e-commerce store"),".\nNo matter if you're using a self-hosted or third-party solution, the connection process is identical."),(0,r.kt)("h3",{id:"21-configure-pcoinpay-server-extension-in-opencart"},"2.1 Configure PCOINPay Server extension in OpenCart"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Menu: Extensions -> Extensions"),(0,r.kt)("li",{parentName:"ol"},"Click the blue edit button"),(0,r.kt)("li",{parentName:"ol"},"Configure PCOINPay extension."),(0,r.kt)("li",{parentName:"ol"},'On the field "Payment Method Enabled" set it to ',(0,r.kt)("inlineCode",{parentName:"li"},"Enabled")),(0,r.kt)("li",{parentName:"ol"},'On field "PCOINPay Server URL" set it to the URL where your PCOINPay Server instance is reachable on the internet e.g. ',(0,r.kt)("inlineCode",{parentName:"li"},"https://pay.pcoin.dev/"),". You can find information on how to deploy your PCOINPay Server instance in the ",(0,r.kt)("a",{parentName:"li",href:"#requirements"},"requirements section above"))),(0,r.kt)("p",null,"Before you can continue, you need to create the API key for your user and store, as described in the next section. Keep this browser tab open, as we will come back shortly."),(0,r.kt)("h3",{id:"22-create-an-api-key-and-configure-permissions"},"2.2 Create an API key and configure permissions"),(0,r.kt)("p",null,"On your PCOINPay Server instance:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Click on ",(0,r.kt)("em",{parentName:"li"},"[Account]")),(0,r.kt)("li",{parentName:"ol"},"Click on ",(0,r.kt)("em",{parentName:"li"},"[Manage Account]")),(0,r.kt)("li",{parentName:"ol"},"Go to the tab ",(0,r.kt)("em",{parentName:"li"},'"API Keys"')),(0,r.kt)("li",{parentName:"ol"},"Click ",(0,r.kt)("em",{parentName:"li"},"[Generate Key]")," to select permissions."),(0,r.kt)("li",{parentName:"ol"},'"Label": Add a label.'),(0,r.kt)("li",{parentName:"ol"},'"Permissions": ',(0,r.kt)("strong",{parentName:"li"},"Important:")," click on the ",(0,r.kt)("em",{parentName:"li"},'"Select specific stores"')," link for the following permissions: ",(0,r.kt)("inlineCode",{parentName:"li"},"View invoices"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"Create invoice"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"Modify invoices"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"Modify stores webhooks"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"View your stores")," and select the store you created for your OpenCart site. This makes sure that the API key only has access to that specific store and can't drain any funds even if the key is lost."),(0,r.kt)("li",{parentName:"ol"},"Click on ",(0,r.kt)("em",{parentName:"li"},"[Generate API Key]")," at the bottom"),(0,r.kt)("li",{parentName:"ol"},"Copy the generated API Key to your ",(0,r.kt)("em",{parentName:"li"},"OpenCart PCOINPay settings"),' form field "PCOINPay API Key"'),(0,r.kt)("li",{parentName:"ol"},"Back on PCOINPay Server instance, go to your store settings and copy the store ID to your ",(0,r.kt)("em",{parentName:"li"},"OpenCart PCOINPay Settings")," form"),(0,r.kt)("li",{parentName:"ol"},"Back on ",(0,r.kt)("em",{parentName:"li"},"OpenCart PCOINPay settings")," form make sure ",(0,r.kt)("strong",{parentName:"li"},"PCOINPay Server URL"),", ",(0,r.kt)("strong",{parentName:"li"},"API Key")," and ",(0,r.kt)("strong",{parentName:"li"},"Store ID")," are set and click ",(0,r.kt)("strong",{parentName:"li"},"[Save]")," button (on the top right)")),(0,r.kt)("p",null,'You should get back to the Extensions overview page and see the notification "PCOINPay Server Payment details have been successfully updated.". If not, ensure your URL, API Key and Store ID are correct.'),(0,r.kt)("p",null,'On successfully saving, the PCOINPay extension automatically creates a webhook so OpenCart can get notified when payments settle or fail. To double check it was successful. You can do that by editing the PCOINPay extension settings again if you see the "Webhook Data" field filled out.'),(0,r.kt)("p",null,"As you can see on the PCOINPay extension settings, you can customize the order statuses depending on the ",(0,r.kt)("a",{parentName:"p",href:"https://doc2p.pcoin.dev/Invoices/#invoice-statuses"},"invoice statuses")," and other common settings. The defaults should be a good starting point but feel free to adjust them to your use case."),(0,r.kt)("h2",{id:"3-test-the-checkout"},"3. Test the checkout"),(0,r.kt)("p",null,"Everything is ready to go now. Make a small test purchase and make sure the order status gets updated according to the PCOINPay invoice status. On the PCOINPay Server invoice details, you can see if the webhook events were successful."),(0,r.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,r.kt)("h3",{id:"enable-debug-mode"},"Enable debug mode"),(0,r.kt)("p",null,'If you have an error during checkout, you can enable the debugging mode on the PCOINPay extension settings. Menu: Go to "Extensions -> extensions" select "Payments" on the "Choose Extension Type" dropdown and edit PCOINPay Server extension.'),(0,r.kt)("p",null,"You can now find the debug output in the ",(0,r.kt)("inlineCode",{parentName:"p"},"error log"),' in the menu "System -> Maintenence -> Error Logs".'),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("strong",{parentName:"p"},"Please make sure to disable it after debugging is finished; otherwise, it will fill up your error logs."))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example Error"),":"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"2022-05-24 21:10:50 ERROR Error during POST to ",(0,r.kt)("a",{parentName:"p",href:"https://pcoinpay.example.com/api/v1/stores/4kD5bvAF5j8DokHqAzxb6MFDV4ikabcdefghijklm/invoices"},"https://pcoinpay.example.com/api/v1/stores/4kD5bvAF5j8DokHqAzxb6MFDV4ikabcdefghijklm/invoices"),". Got response (401): {",'"',"code",'"',":",'"',"unauthenticated",'"',",",'"',"message",'"',":",'"',"Authentication is required for accessing this endpoint",'"',"}")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"This means there is some authentication error. Likely your API key does not have permission to create invoices for that store. Make sure you give the API key the correct permissions, give it to the right store, and enter that in the OpenCart payment configuration form.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},'Another reason could be that you use a legacy API key. The legacy API keys are located in store settings -> Access Tokens. But you need to create an account API key located in Account -> Manage Account -> tab "API Keys". See section ',(0,r.kt)("a",{parentName:"p",href:"#22-create-an-api-key-and-configure-permissions"},"2.2 Create an API key and configure permissions"),"."))),(0,r.kt)("h2",{id:"the-order-states-do-not-update-although-the-invoice-has-been-paid"},"The order states do not update, although the invoice has been paid."),(0,r.kt)("p",null,'Please check your invoice details to see if there were any errors on sending the webhook request. Some hosting providers, firewall setups, or security extensions may block POST requests to your site, which leads to an HTTP status of "403 forbidden".'),(0,r.kt)("p",null,"You can check and verify yourself if there is something blocking requests to your site in one of these two ways:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"1. Copy webhook callback URL"),(0,r.kt)("br",{parentName:"p"}),"\n","Go to your ",(0,r.kt)("em",{parentName:"p"},"OpenCart PCOINPay extension settings"),' and copy the "URL" of the "Webhook Data" field. e.g., ',(0,r.kt)("inlineCode",{parentName:"p"},"https://YOURSTOREDOMAIN.TLD/index.php?route=extension/payment/pcoinpay/callback")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"2.1 Check using a command line (Linux or MacOS):")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'curl -vX POST -H "Content-Type: application/json" \\\n    -d \'{"data": "test"}\' WEBHOOK_CALLBACK_URL\n')),(0,r.kt)("p",null,"(replace ",(0,r.kt)("inlineCode",{parentName:"p"},"WEBHOOK_CALLBACK_URL")," with the one copied above)"),(0,r.kt)("p",null,"Result:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},".... snip ....\n* upload completely sent off: 16 out of 16 bytes\n< HTTP/1.1 403 Forbidden\n< access-control-allow-origin: *\n< Content-Type: application/json; charset=UTF-8\n< X-Cloud-Trace-Context: 4f07d5b2e5c2f05949d04421a8e2dd6a\n< Date: Thu, 17 Feb 2022 10:06:50 GMT\n< Server: Google Frontend\n< Content-Length: 26\n")),(0,r.kt)("p",null,'If you see that line "HTTP/1.1 403 Forbidden" or "HTTP/2 403" something is blocking data sent to your OpenCart site. It would be best to ask your hosting provider or make sure no firewall or security extension is blocking the requests.'),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"2.2 Check using an online service if you do not have a command line available:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Go to ",(0,r.kt)("a",{parentName:"li",href:"https://reqbin.com/post-online"},"https://reqbin.com/post-online")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Enter your callback url (copied from step 1 above): ",(0,r.kt)("inlineCode",{parentName:"li"},"https://YOURSTOREDOMAIN.TLD/index.php?route=extension/payment/pcoinpay/callback"),"\n(replace this URL with the webhook callback url from step 1)"))),(0,r.kt)("li",{parentName:"ul"},'Make sure "POST" is selected'),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li",start:2},(0,r.kt)("li",{parentName:"ol"},"Click ","[Send]")))),(0,r.kt)("p",null,'If you see "',(0,r.kt)("strong",{parentName:"p"},"Status 403 (Forbidden)"),'" then POST requests to your site are blocked for some reason. You should ask your hosting provider or ensure no firewall or security extension is blocking the requests. If you see any other status code (200, 500, ...) a firewall problem seems not to apply. You probably need to investigate further.'))}m.isMDXComponent=!0}}]);