"use strict";(self.webpackChunkpcoin_website=self.webpackChunkpcoin_website||[]).push([[4784],{4137:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return d}});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var c=r.createContext({}),s=function(e){var n=r.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},u=function(e){var n=s(e.components);return r.createElement(c.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},p=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,c=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=s(t),d=o,f=p["".concat(c,".").concat(d)]||p[d]||m[d]||i;return t?r.createElement(f,a(a({ref:n},u),{},{components:t})):r.createElement(f,a({ref:n},u))}));function d(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,a=new Array(i);a[0]=p;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var s=2;s<i;s++)a[s]=t[s];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}p.displayName="MDXCreateElement"},8826:function(e,n,t){t.r(n),t.d(n,{assets:function(){return u},contentTitle:function(){return c},default:function(){return d},frontMatter:function(){return l},metadata:function(){return s},toc:function(){return m}});var r=t(3117),o=t(102),i=(t(7294),t(4137)),a=["components"],l={title:"Reduce Memory",sidebar_position:3},c=void 0,s={unversionedId:"Pcoin-Core/Miscellaneous/reduce-memory",id:"Pcoin-Core/Miscellaneous/reduce-memory",title:"Reduce Memory",description:"There are a few parameters that can be dialed down to reduce the memory usage of pcoind. This can be useful on embedded systems or small VPSes.",source:"@site/docs/Pcoin-Core/Miscellaneous/reduce-memory.md",sourceDirName:"Pcoin-Core/Miscellaneous",slug:"/Pcoin-Core/Miscellaneous/reduce-memory",permalink:"/docs/Pcoin-Core/Miscellaneous/reduce-memory",draft:!1,editUrl:"https://github.com/pcoinproject/pcoin.dev/edit/master/docs/Pcoin-Core/Miscellaneous/reduce-memory.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Reduce Memory",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Fuzzing PCOIN Core using libFuzzer",permalink:"/docs/Pcoin-Core/Miscellaneous/fuzzing"},next:{title:"TOR SUPPORT IN PCOIN",permalink:"/docs/Pcoin-Core/Miscellaneous/tor"}},u={},m=[{value:"In-memory caches",id:"in-memory-caches",level:2},{value:"Memory pool",id:"memory-pool",level:2},{value:"Number of peers",id:"number-of-peers",level:2},{value:"Thread configuration",id:"thread-configuration",level:2},{value:"Linux specific",id:"linux-specific",level:2}],p={toc:m};function d(e){var n=e.components,t=(0,o.Z)(e,a);return(0,i.kt)("wrapper",(0,r.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"There are a few parameters that can be dialed down to reduce the memory usage of ",(0,i.kt)("inlineCode",{parentName:"p"},"pcoind"),". This can be useful on embedded systems or small VPSes."),(0,i.kt)("h2",{id:"in-memory-caches"},"In-memory caches"),(0,i.kt)("p",null,"The size of some in-memory caches can be reduced. As caches trade off memory usage for performance, reducing these will usually have a negative effect on performance."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-dbcache=<n>")," - the UTXO database cache size, this defaults to ",(0,i.kt)("inlineCode",{parentName:"li"},"450"),". The unit is MiB (1024).",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"The minimum value for ",(0,i.kt)("inlineCode",{parentName:"li"},"-dbcache")," is 4."),(0,i.kt)("li",{parentName:"ul"},"A lower ",(0,i.kt)("inlineCode",{parentName:"li"},"-dbcache")," makes initial sync time much longer. After the initial sync, the effect is less pronounced for most use-cases, unless fast validation of blocks is important, such as for mining.")))),(0,i.kt)("h2",{id:"memory-pool"},"Memory pool"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"In PCOIN Core there is a memory pool limiter which can be configured with ",(0,i.kt)("inlineCode",{parentName:"p"},"-maxmempool=<n>"),", where ",(0,i.kt)("inlineCode",{parentName:"p"},"<n>")," is the size in MB (1000). The default value is ",(0,i.kt)("inlineCode",{parentName:"p"},"300"),"."),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"The minimum value for ",(0,i.kt)("inlineCode",{parentName:"li"},"-maxmempool")," is 5."),(0,i.kt)("li",{parentName:"ul"},"A lower maximum mempool size means that transactions will be evicted sooner. This will affect any uses of ",(0,i.kt)("inlineCode",{parentName:"li"},"pcoind")," that process unconfirmed transactions."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Unused memory allocated to the mempool (default: 300MB) is shared with the UTXO cache, so when trying to reduce memory usage you should limit the mempool, with the ",(0,i.kt)("inlineCode",{parentName:"p"},"-maxmempool")," command line argument."))),(0,i.kt)("h2",{id:"number-of-peers"},"Number of peers"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-maxconnections=<n>")," - the maximum number of connections, this defaults to ",(0,i.kt)("inlineCode",{parentName:"li"},"125"),". Each active connection takes up some memory. Only significant if incoming\nconnections are enabled, otherwise the number of connections will never be more than ",(0,i.kt)("inlineCode",{parentName:"li"},"8"),".")),(0,i.kt)("h2",{id:"thread-configuration"},"Thread configuration"),(0,i.kt)("p",null,"For each thread a thread stack needs to be allocated. By default on Linux,\nthreads take up 8MiB for the thread stack on a 64-bit system, and 4MiB in a\n32-bit system."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-par=<n>")," - the number of script verification threads, defaults to the number of cores in the system minus one."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-rpcthreads=<n>")," - the number of threads used for processing RPC requests, defaults to ",(0,i.kt)("inlineCode",{parentName:"li"},"4"),".")),(0,i.kt)("h2",{id:"linux-specific"},"Linux specific"),(0,i.kt)("p",null,"By default, since glibc ",(0,i.kt)("inlineCode",{parentName:"p"},"2.10"),", the C library will create up to two heap arenas per core. This is known to cause excessive memory usage in some scenarios. To avoid this make a script that sets ",(0,i.kt)("inlineCode",{parentName:"p"},"MALLOC_ARENA_MAX")," before starting pcoind:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"#!/usr/bin/env bash\nexport MALLOC_ARENA_MAX=1\npcoind\n")),(0,i.kt)("p",null,"The behavior was introduced to increase CPU locality of allocated memory and performance with concurrent allocation, so this setting could in theory reduce performance. However, in PCOIN Core very little parallel allocation happens, so the impact is expected to be small or absent."))}d.isMDXComponent=!0}}]);