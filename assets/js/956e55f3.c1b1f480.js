"use strict";(self.webpackChunkpcoin_website=self.webpackChunkpcoin_website||[]).push([[6404],{4137:function(e,t,o){o.d(t,{Zo:function(){return u},kt:function(){return d}});var n=o(7294);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,n,a=function(e,t){if(null==e)return{};var o,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||(a[o]=e[o]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var s=n.createContext({}),p=function(e){var t=n.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):i(i({},t),e)),o},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var o=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=p(o),d=a,y=m["".concat(s,".").concat(d)]||m[d]||c[d]||r;return o?n.createElement(y,i(i({ref:t},u),{},{components:o})):n.createElement(y,i({ref:t},u))}));function d(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=o.length,i=new Array(r);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var p=2;p<r;p++)i[p]=o[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,o)}m.displayName="MDXCreateElement"},7167:function(e,t,o){o.r(t),o.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return d},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return c}});var n=o(3117),a=o(102),r=(o(7294),o(4137)),i=["components"],l={title:"WooCommerce",sidebar_position:21,description:"How to integrate PCOINPay Server into your WooCommerce store.",tags:["WooCommerce","WordPress","Plugin","eCommerce"]},s="WooCommerce integration",p={unversionedId:"PcoinPay/Guide/WooCommerce",id:"PcoinPay/Guide/WooCommerce",title:"WooCommerce",description:"How to integrate PCOINPay Server into your WooCommerce store.",source:"@site/docs/PcoinPay/Guide/WooCommerce.md",sourceDirName:"PcoinPay/Guide",slug:"/PcoinPay/Guide/WooCommerce",permalink:"/docs/PcoinPay/Guide/WooCommerce",draft:!1,editUrl:"https://github.com/pcoinproject/pcoin.dev/edit/master/docs/PcoinPay/Guide/WooCommerce.md",tags:[{label:"WooCommerce",permalink:"/docs/tags/woo-commerce"},{label:"WordPress",permalink:"/docs/tags/word-press"},{label:"Plugin",permalink:"/docs/tags/plugin"},{label:"eCommerce",permalink:"/docs/tags/e-commerce"}],version:"current",sidebarPosition:21,frontMatter:{title:"WooCommerce",sidebar_position:21,description:"How to integrate PCOINPay Server into your WooCommerce store.",tags:["WooCommerce","WordPress","Plugin","eCommerce"]},sidebar:"tutorialSidebar",previous:{title:"Payjoin",permalink:"/docs/PcoinPay/Guide/Payjoin"},next:{title:"Shopify",permalink:"/docs/PcoinPay/Guide/Shopify"}},u={},c=[{value:"Requirements",id:"requirements",level:2},{value:"1. Install PCOINPay Plugin",id:"1-install-pcoinpay-plugin",level:2},{value:"2. Connecting WooCommerce and PCOINPay Server",id:"2-connecting-woocommerce-and-pcoinpay-server",level:2},{value:"2.1 Connect using the API key wizard (recommended)",id:"21-connect-using-the-api-key-wizard-recommended",level:3},{value:"2.2 Connect by manually creating the API key and permissions",id:"22-connect-by-manually-creating-the-api-key-and-permissions",level:3},{value:"3. Testing the checkout",id:"3-testing-the-checkout",level:2},{value:"4. Customizing PCOINPay WooCommerce V2",id:"4-customizing-pcoinpay-woocommerce-v2",level:2},{value:"4.1 Global Settings",id:"41-global-settings",level:3},{value:"4.2 Payment Gateway specific",id:"42-payment-gateway-specific",level:3},{value:"4.2.1 PCOINPay (default)",id:"421-pcoinpay-default",level:4},{value:"4.2.2 Separate Payment Gateways",id:"422-separate-payment-gateways",level:4},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Error: Call to undefined function PCOINPayServerHttpcurl_init()",id:"error-call-to-undefined-function-pcoinpayserverhttpcurl_init",level:3},{value:"The order states do not update although the invoice has been paid",id:"the-order-states-do-not-update-although-the-invoice-has-been-paid",level:3},{value:"I get an error during checkout but not sure what the problem is.",id:"i-get-an-error-during-checkout-but-not-sure-what-the-problem-is",level:3},{value:"Create a new API key",id:"create-a-new-api-key",level:3},{value:"I messed around with the webhook, how to fix",id:"i-messed-around-with-the-webhook-how-to-fix",level:3},{value:"Deploying WooCommerce from PCOINPay Server",id:"deploying-woocommerce-from-pcoinpay-server",level:2}],m={toc:c};function d(e){var t=e.components,o=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,n.Z)({},m,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"woocommerce-integration"},"WooCommerce integration"),(0,r.kt)("p",null,"This document explains how to ",(0,r.kt)("strong",{parentName:"p"},"integrate PCOINPay Server into your WooCommerce store"),"."),(0,r.kt)("admonition",{title:"Note",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"This guide refers to the PCOINPay for WooCommerce V2 plugin. You can find instructions for the now unmaintained legacy plugin (based on BitPay API) ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/pcoinproject/pcoinpayserver-doc/blob/master/docs/WooCommerce.md"},"here"),".")),(0,r.kt)("p",null,"To integrate PCOINPay Server into an existing WooCommerce store, follow the steps below."),(0,r.kt)("h2",{id:"requirements"},"Requirements"),(0,r.kt)("p",null,"Please ensure that you meet the following requirements before installing this plugin."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"PHP version 7.4 or newer"),(0,r.kt)("li",{parentName:"ul"},"The cURL, gd, intl, json, and mbstring PHP extensions are available"),(0,r.kt)("li",{parentName:"ul"},"A WooCommerce website (",(0,r.kt)("a",{parentName:"li",href:"https://woocommerce.com/document/installing-uninstalling-woocommerce/"},"Installation instructions")," or ",(0,r.kt)("a",{parentName:"li",href:"#deploying-woocommerce-from-pcoinpay-server"},"directly on PCOINPay Server"),")"),(0,r.kt)("li",{parentName:"ul"},"You have a PCOINPay Server, either ",(0,r.kt)("a",{parentName:"li",href:"../Deployment/README.md"},"self-hosted")," or ",(0,r.kt)("a",{parentName:"li",href:"../Deployment/ThirdPartyHosting.md"},"hosted by a third-party")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/PcoinPay/Guide/RegisterAccount"},"You've a registered account on the instance")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/PcoinPay/Guide/CreateStore"},"You've a PCOINPay store on the instance")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/PcoinPay/Guide/WalletSetup/"},"You've a wallet connected to your store"))),(0,r.kt)("h2",{id:"1-install-pcoinpay-plugin"},"1. Install PCOINPay Plugin"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"download PCOINPay for WooCommerce V2 plugin"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/pcoinproject/woocommerce-greenfield-plugin/releases"},"GitHub Repository"))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/pcoinproject/woocommerce-greenfield-plugin/releases"},"Download the latest PCOINPay plugin"),", upload it in .zip format to your WordPress site and activate it."),(0,r.kt)("h2",{id:"2-connecting-woocommerce-and-pcoinpay-server"},"2. Connecting WooCommerce and PCOINPay Server"),(0,r.kt)("p",null,"PCOINPay for WooCommerce V2 plugin is a ",(0,r.kt)("strong",{parentName:"p"},"bridge between your PCOINPay Server (payment processor) and your e-commerce store"),".\nNo matter if you're using a self-hosted or third-party solution, the connection process is identical."),(0,r.kt)("p",null,'You can either click on the notifications link saying "',(0,r.kt)("strong",{parentName:"p"},"please configure the plugin here"),'", or:'),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Go to your store dashboard."),(0,r.kt)("li",{parentName:"ul"},"WooCommerce > Settings."),(0,r.kt)("li",{parentName:"ul"},"Click ","[PCOINPay Settings]"," tab.")),(0,r.kt)("h3",{id:"21-connect-using-the-api-key-wizard-recommended"},"2.1 Connect using the API key wizard (recommended)"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},'In the field "',(0,r.kt)("strong",{parentName:"li"},"PCOINPay Server URL"),'", enter the full URL of your host (including the https) \u2013 ',(0,r.kt)("a",{parentName:"li",href:"https://pcoinpay.mydomain.com"},"https://pcoinpay.mydomain.com")),(0,r.kt)("li",{parentName:"ol"},'Click on the link below the "',(0,r.kt)("strong",{parentName:"li"},"PCOINPay Api Key"),'" field that says "',"*",(0,r.kt)("em",{parentName:"li"},"click here to generate API keys"),'" you will be redirected to PCOINPay Server "Authorization request" page.'),(0,r.kt)("li",{parentName:"ol"},"If you are not logged in to your PCOINPay Server instance, do so now. (optional)"),(0,r.kt)("li",{parentName:"ol"},"Select the store you want to connect to (if you only have one store it will get autoselected)."),(0,r.kt)("li",{parentName:"ol"},"All required permissions are prefilled already, you just need to click ","[Authorize app]"),(0,r.kt)("li",{parentName:"ol"},"You will get redirected to your WooCommerce store and the API key and Store ID will be prefilled."),(0,r.kt)("li",{parentName:"ol"},"Before doing any further configuration click on ",(0,r.kt)("strong",{parentName:"li"},"[Save]")," as it will setup the webhook for you.")),(0,r.kt)("p",null,'Continue with "3. Testing the checkout" below.'),(0,r.kt)("h3",{id:"22-connect-by-manually-creating-the-api-key-and-permissions"},"2.2 Connect by manually creating the API key and permissions"),(0,r.kt)("p",null,"If you can't use the wizard mentioned in the previous section you can also generate the API key manually."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Click on ",(0,r.kt)("em",{parentName:"li"},"[Account]")," -> ",(0,r.kt)("em",{parentName:"li"},"Manage Account")," on the bottom left"),(0,r.kt)("li",{parentName:"ol"},"Go to the tab ",(0,r.kt)("em",{parentName:"li"},'"API Keys"')),(0,r.kt)("li",{parentName:"ol"},"Click ",(0,r.kt)("em",{parentName:"li"},"[Generate Key]")," to select permissions."),(0,r.kt)("li",{parentName:"ol"},"Click on the ",(0,r.kt)("em",{parentName:"li"},'"Select specific stores"')," link for the following permissions: ",(0,r.kt)("inlineCode",{parentName:"li"},"View invoices"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"Create invoice"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"Modify invoices"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"Modify stores webhooks"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"View your stores"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"Create non-approved pull payments")," (used for refunds)"),(0,r.kt)("li",{parentName:"ol"},"Click on ",(0,r.kt)("em",{parentName:"li"},"[Generate API Key]")),(0,r.kt)("li",{parentName:"ol"},"Copy the generated API Key to your WordPress ",(0,r.kt)("em",{parentName:"li"},"PCOINPay Settings")," form"),(0,r.kt)("li",{parentName:"ol"},"Copy the store ID to your WordPress ",(0,r.kt)("em",{parentName:"li"},"PCOINPay Settings")," form"),(0,r.kt)("li",{parentName:"ol"},"On the PCOINPay Settings form make sure ",(0,r.kt)("em",{parentName:"li"},"PCOINPay Server URL"),", ",(0,r.kt)("em",{parentName:"li"},"PCOINPay Server API Key")," and ",(0,r.kt)("em",{parentName:"li"},"Store ID")," are set and click ",(0,r.kt)("em",{parentName:"li"},"[Save]")),(0,r.kt)("li",{parentName:"ol"},'Make sure you see the notification "',(0,r.kt)("em",{parentName:"li"},"PCOINPay Server: Successfully registered a new webhook on PCOINPay Server"),'"')),(0,r.kt)("h2",{id:"3-testing-the-checkout"},"3. Testing the checkout"),(0,r.kt)("p",null,"Making a small test-purchase from your store will give you peace of mind.\nAlways make sure that everything is set up correctly before going live."),(0,r.kt)("h2",{id:"4-customizing-pcoinpay-woocommerce-v2"},"4. Customizing PCOINPay WooCommerce V2"),(0,r.kt)("h3",{id:"41-global-settings"},"4.1 Global Settings"),(0,r.kt)("p",null,"Can be found at ",(0,r.kt)("em",{parentName:"p"},"WooCommerce -> Settings -> Tab ","[PCOINPay Settings]")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"PCOINPay Server URL")),(0,r.kt)("p",null,"URL to your PCOINPay Server instance, including protocol e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"https://pcoinpay.yourdomain.com"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"PCOINPay API Key")),(0,r.kt)("p",null,"Your API Key. (Was auto-generated in the steps before)."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Store ID")),(0,r.kt)("p",null,"The store ID of your PCOINPay Server store. Can be found on the store settings page."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Default Customer Message")),(0,r.kt)("p",null,'Here you can customize the customer message shown after selecting PCOINPay payment gateway on checkout. This can be overwritten on the payment gateway settings for each gateway if you use the "Separate payment gateways" option.'),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},'Invoice pass to "Settled" state after')),(0,r.kt)("p",null,"Set after how many confirmations a payment is considered fully paid and settled. Defaults to what is configured on PCOINPay store settings."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"PCOINPay Order Statuses")),(0,r.kt)("p",null,"Depending on your business model and store settings, you may want to configure your order statuses.\nYou can set PCOINPay to trigger certain order status in WooCommerce automatically."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"New")," - order placed, not paid yet."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Paid")," - order paid, not enough confirmations on the blockchain, yet."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Settled")," - order paid, confirmed on the blockchain."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Settled (paid over)")," - order paid, confirmed on the blockchain but paid over."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Invalid")," - order paid, did not get a sufficient number of confirmations in a pre-defined time-frame set in PCOINPay store settings, or manually marked invalid."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Expired")," - invoice expired, order not paid."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Expired with partial payment")," - invoice expired and paid partially")),(0,r.kt)("p",null,'Take time to think about how you wish to automate these statuses.\nIf you do not wish certain PCOINPay status to trigger WooCommerce order status, you can leave it as default "- no mapping / defaults -".'),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},'you should keep the "Settled" order status to "- no mapping / defaults-" if you sell digital and physical products. For digital products WooCommerce will automatically skip the "Processing" status and go directly to "Completed" for those orders only containing digital products.')),(0,r.kt)("p",null,'Another example, if a merchant wants to send an email notifying the customer that the payment has been received, but the order will be processed upon confirmation, the merchant would have to set order status for "Paid" to "On hold". Then, the merchant would have to customize and trigger email for "On hold" status of the order in WooCommerce.'),(0,r.kt)("p",null,"It takes some time to find a perfect formula, so users should test things out before going live."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Separate Payment Gateways")),(0,r.kt)("p",null,"If this option is enabled the plugin will generate one separate payment gateway per supported payment method on PCOINPay Server. E.g. if you have BTC,PCOIN, LightningNetwork and maybe Liquid Assets enabled on your PCOINPay Server store, then you will have a separate gateway available for each. This allows many new use cases like discount per gateway or country based restrictions. More details ",(0,r.kt)("a",{parentName:"p",href:"../FAQ/Integrations/#how-to-configure-additional-token-support"},"here"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Send customer data to PCOINPayServer")),(0,r.kt)("p",null,"By default ",(0,r.kt)("em",{parentName:"p"},"no")," customer data beside email is sent to PCOINPay Server. If you want to send customer address data to PCOINPay Server you can enable it here."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Debug Log")),(0,r.kt)("p",null,"This option is helpful in case you have a problem and need more information on what is going on. The logs can be then found under WooCommerce -> Status -> Log. Make sure you disable this again after debugging as it will fill up your filesystem with logs."),(0,r.kt)("h3",{id:"42-payment-gateway-specific"},"4.2 Payment Gateway specific"),(0,r.kt)("p",null,'Depending on wheter you have above mentioned "Separate Payment Gateways" enabled you will have one or more Payment Gateways available to configure in the payment gateway settings via ',(0,r.kt)("em",{parentName:"p"},"WooCommerce -> Settings -> Tab ","[Payments]")),(0,r.kt)("p",null,"On all payment gateways you can set the following options:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Title"),'\nThe shown payment gateway text on the checkout page. Defaults to "PCOINPay (Bitcoin, Pcoin, Lightning Network, ...)".'),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Customer Message")),(0,r.kt)("p",null,"Here you can customize message shown after selecting PCOINPay payment gateway."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Gateway Icon")),(0,r.kt)("p",null,"Upload or select a custom icon to be shown next to the payment gateway during checkout. Defaults to PCOINPay logo."),(0,r.kt)("h4",{id:"421-pcoinpay-default"},"4.2.1 PCOINPay (default)"),(0,r.kt)("p",null,"Additional options only available for the default payment gateway:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Enforce payment tokens")),(0,r.kt)("p",null,'With "Separate Payment Gateways" feature enabled in PCOINPay Settings you can use this option to enforce only payment tokens. This means that the created invoice will ',(0,r.kt)("em",{parentName:"p"},"only"),' include tokens of type "payment" and ',(0,r.kt)("em",{parentName:"p"},"not any"),' of type "promotion". See difference of token types ',(0,r.kt)("a",{parentName:"p",href:"../FAQ/Integrations/#how-to-configure-additional-token-support#token-types"},"here")),(0,r.kt)("h4",{id:"422-separate-payment-gateways"},"4.2.2 Separate Payment Gateways"),(0,r.kt)("p",null,"Additional options only available for the separate payment gateways (if that feature is enabled):"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Token Type")),(0,r.kt)("p",null,'By default type "payment" is selected. But if you have Liquid Assets with your own issued asset/token (e.g. used as voucher) you can select "promotion" here. Those are processed differently than normal payment tokens. Details can be found ',(0,r.kt)("a",{parentName:"p",href:"../FAQ/Integrations/#how-to-configure-additional-token-support#promotional-tokens-100-discount"},"here")),(0,r.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,r.kt)("h3",{id:"error-call-to-undefined-function-pcoinpayserverhttpcurl_init"},"Error: Call to undefined function PCOINPayServer\\Http\\curl_init()"),(0,r.kt)("p",null,"Please make sure your PHP version supports the cURL extension (as written in the requirements above). You can install it on Debian/Ubuntu by running the command ",(0,r.kt)("inlineCode",{parentName:"p"},"sudo apt install php-curl"),"."),(0,r.kt)("h3",{id:"the-order-states-do-not-update-although-the-invoice-has-been-paid"},"The order states do not update although the invoice has been paid"),(0,r.kt)("p",null,"Please check first if the webhook is created under the PCOINPay Server store settings. If there is no webhook created you can visit on your WooCommerce store PCOINPay Settings tab under WooCommerce settings and hit the save button. This will create the webhook."),(0,r.kt)("p",null,'You may also check the details of your invoice if there were any errors on sending the webhook request. Some hosting providers, firewall setups or WordPress security plugins (like Wordfence) block POST requests to your WordPress site which lead to a http status of "403 Forbidden" or "503 Service Unavailable".'),(0,r.kt)("p",null,"You can check and verify yourself if there is something blocking requests to your site in one of these two ways:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Check using a command line (Linux or MacOS):"),"\n(replace EXAMPLE.COM with your WordPress site URL)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'curl -vX POST -H "Content-Type: application/json" \\\n    -d \'{"data": "test"}\' https://EXAMPLE.COM/?wc-api=pcoinpaygf_default\n')),(0,r.kt)("p",null,'On the response, if you see that line "HTTP/1.1 500" or "HTTP/2 500" and the message "Webhook request validation failed" that means that your site is not blocking the request with a "403 Forbidden".'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'.... snip ....\n* We are completely uploaded and fine\n< HTTP/2 500\n< server: nginx\n< date: Sun, 05 Jun 2022 16:55:08 GMT\n< content-type: application/json; charset=UTF-8\n< x-powered-by: PHP/8.1.6\n< expires: Wed, 11 Jan 1984 05:00:00 GMT\n< cache-control: no-cache, must-revalidate, max-age=0\n<\n* Connection #0 to host example.com left intact\n{"code":"wp_die","message":"Webhook request validation failed.","data":{"status":500},"additional_errors":[]}\n')),(0,r.kt)("p",null,'On the other side, if you see that line "HTTP/1.1 403 Forbidden" or "HTTP/2 403" then something is blocking data sent to your WordPress site. You should ask your hosting provider or make sure no firewall or plugin is blocking the requests.'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},".... snip ....\n* upload completely sent off: 16 out of 16 bytes\n< HTTP/1.1 403 Forbidden\n< access-control-allow-origin: *\n< Content-Type: application/json; charset=UTF-8\n< X-Cloud-Trace-Context: 4f07d5b2e5c2f05949d04421a8e2dd6a\n< Date: Thu, 17 Feb 2022 10:06:50 GMT\n< Server: Google Frontend\n< Content-Length: 26\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Check using an online service (if you do not have a command line available:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Go to ",(0,r.kt)("a",{parentName:"li",href:"https://reqbin.com/post-online"},"https://reqbin.com/post-online")),(0,r.kt)("li",{parentName:"ul"},"Enter your domain: ",(0,r.kt)("inlineCode",{parentName:"li"},"https://EXAMPLE.COM/?wc-api=pcoinpaygf_default"),"\n(replace EXAMPLE.COM with your WordPress site URL)"),(0,r.kt)("li",{parentName:"ul"},'Make sure "POST" is selected'),(0,r.kt)("li",{parentName:"ul"},"Click ","[Send]")),(0,r.kt)("p",null,'If you see "Status 403 (Forbidden)" then POST requests to your site are blocked for some reason. You should ask your hosting provider or make sure no firewall or plugin is blocking the requests.'),(0,r.kt)("h3",{id:"i-get-an-error-during-checkout-but-not-sure-what-the-problem-is"},"I get an error during checkout but not sure what the problem is."),(0,r.kt)("p",null,"In your PCOINPay Settings in your admin dashboard: ",(0,r.kt)("em",{parentName:"p"},"WooCommerce -> Settings: Tab ","[PCOINPay Settings]")," you can enable debug mode by setting the checkbox on that option."),(0,r.kt)("p",null,"You can now find more detailed Logs when you click the ","[View Logs]"," button or you go to ",(0,r.kt)("em",{parentName:"p"},"WooCommerce -> Status: Tab ","[Logs]")," and select the most recent pcoinpay logs."),(0,r.kt)("admonition",{title:"Warning",type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"Please make sure that you disable the debugging mode again after you finished investigating, otherwise your site performance may be impacted and also write lots of logging data in your filesystem for no reason.")),(0,r.kt)("p",null,"Additionally you can also look into your webservers error logs if you find any error that is related to PCOINPay plugin."),(0,r.kt)("h3",{id:"create-a-new-api-key"},"Create a new API key"),(0,r.kt)("p",null,"If you have been using the WooCommerce V2 plugin prior to version 2.0.0, your API key won't have the required permissions to issue refunds via pull-payments. If you want to use that feature, you can create a new API key (editing an API key is not currently supported). You can use the above described ",(0,r.kt)("a",{parentName:"p",href:"#21-connect-using-the-api-key-wizard--recommended-"},"2.1 Connect using API key wizard")," or the ",(0,r.kt)("a",{parentName:"p",href:"#22-connect-by-manually-creating-the-api-key-and-permissions"},"manual API key generation"),". The configured webhook will continue to work, and no change is needed."),(0,r.kt)("h3",{id:"i-messed-around-with-the-webhook-how-to-fix"},"I messed around with the webhook, how to fix"),(0,r.kt)("p",null,"Suppose you accidentally changed the WooCommerce webhook, and it is not working anymore. In that case, you can quickly force a re-creation of it when you delete the API key on PCOINPay Server and then go to the PCOINPay Server Settings (on your WordPress site) and hit save again. You should see a message that the webhook was successfully created."),(0,r.kt)("h2",{id:"deploying-woocommerce-from-pcoinpay-server"},"Deploying WooCommerce from PCOINPay Server"),(0,r.kt)("p",null,"If you already have PCOINPay Server, you can very easily start WooCommerce from your existing environment."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Point the external IP of the virtual machine where your PCOINPay is hosted to your store domain, for example store.yourdomain.com.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Log into your PCOINPay server as root."))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo su -\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Set up WooCommerce variables. You can add ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/pcoinproject/pcoinpayserver-docker/blob/master/docker-compose-generator/docker-fragments/opt-add-woocommerce.yml"},"optional variables")," as well.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'export PCOINPAYGEN_ADDITIONAL_FRAGMENTS="$PCOINPAYGEN_ADDITIONAL_FRAGMENTS;opt-add-woocommerce"\nexport WOOCOMMERCE_HOST="yourstoredomain.com"\n')),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"Lastly, just run PCOINPay Setup script which will add the set up variables.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},". ./pcoinpay-setup.sh -i\n")),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"Go to your store's domain name, in our example that's store.yourdomain.com and follow the WordPress installation wizard.")))}d.isMDXComponent=!0}}]);