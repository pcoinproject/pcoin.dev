"use strict";(self.webpackChunkpcoin_website=self.webpackChunkpcoin_website||[]).push([[3714],{4137:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return g}});var i=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),u=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=u(e.components);return i.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},c=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),c=u(n),g=a,m=c["".concat(s,".").concat(g)]||c[g]||d[g]||r;return n?i.createElement(m,l(l({ref:t},p),{},{components:n})):i.createElement(m,l({ref:t},p))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,l=new Array(r);l[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:a,l[1]=o;for(var u=2;u<r;u++)l[u]=n[u];return i.createElement.apply(null,l)}return i.createElement.apply(null,n)}c.displayName="MDXCreateElement"},7899:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return g},frontMatter:function(){return o},metadata:function(){return u},toc:function(){return d}});var i=n(3117),a=n(102),r=(n(7294),n(4137)),l=["components"],o={title:"Gitian building",description:"Setup instructions for a gitian build of PCOIN Core using a VM or physical system",sidebar_position:4},s=void 0,u={unversionedId:"Pcoin-Core/Building/gitian-building/gitian-building",id:"Pcoin-Core/Building/gitian-building/gitian-building",title:"Gitian building",description:"Setup instructions for a gitian build of PCOIN Core using a VM or physical system",source:"@site/docs/Pcoin-Core/Building/gitian-building/gitian-building.md",sourceDirName:"Pcoin-Core/Building/gitian-building",slug:"/Pcoin-Core/Building/gitian-building/",permalink:"/docs/Pcoin-Core/Building/gitian-building/",draft:!1,editUrl:"https://github.com/pcoinproject/pcoin.dev/edit/master/docs/Pcoin-Core/Building/gitian-building/gitian-building.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"Gitian building",description:"Setup instructions for a gitian build of PCOIN Core using a VM or physical system",sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Windows Build guide",permalink:"/docs/Pcoin-Core/Building/build-windows"},next:{title:"Setting up Docker for macOS",permalink:"/docs/Pcoin-Core/Building/gitian-building/docker-setup-mac"}},p={},d=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Preparing the Gitian builder host",id:"preparing-the-gitian-builder-host",level:2},{value:"macOS Builds",id:"macos-builds",level:4},{value:"Initial Gitian Setup",id:"initial-gitian-setup",level:2},{value:"Building PCOIN Core",id:"building-pcoin-core",level:2},{value:"Signing Externally",id:"signing-externally",level:2},{value:"Uploading Signatures",id:"uploading-signatures",level:2}],c={toc:d};function g(e){var t=e.components,n=(0,a.Z)(e,l);return(0,r.kt)("wrapper",(0,i.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Setup instructions for a gitian build of PCOIN Core using a VM or physical system.")),(0,r.kt)("p",null,"Gitian is the deterministic build process that is used to build the PCOIN\nCore executables. It provides a way to be reasonably sure that the\nexecutables are really built from source on GitHub. It also makes sure that\nthe same, tested dependencies are used and statically built into the executable."),(0,r.kt)("p",null,'Multiple developers build the source code by following a specific descriptor\n("recipe"), cryptographically sign the result, and upload the resulting signature.\nThese results are compared and only if they match, the build is accepted and uploaded\nto the PCOIN GitHub release page.'),(0,r.kt)("p",null,"More independent gitian builders are needed, which is why this guide exists.\nIt is preferred to follow these steps yourself instead of using someone else's\nVM image to avoid 'contaminating' the build."),(0,r.kt)("h2",{id:"table-of-contents"},"Table of Contents"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#preparing-the-gitian-builder-host"},"Preparing the Gitian builder host"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#macos-builds"},"macOS Builds")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#initial-gitian-setup"},"Initial Gitian Setup")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#building-pcoin-core"},"Building PCOIN Core")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#signing-externally"},"Signing externally")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#uploading-signatures"},"Uploading signatures"))),(0,r.kt)("h2",{id:"preparing-the-gitian-builder-host"},"Preparing the Gitian builder host"),(0,r.kt)("p",null,"The first step is to prepare the host environment that will be used to perform the Gitian builds.\nThis guide explains how to set up the environment, and how to start the builds."),(0,r.kt)("p",null,"Gitian builds are known to be working on recent versions of Windows 10, Debian, Ubuntu, Fedora and macOS.\nIf your machine is already running one of those operating systems, you can perform Gitian builds on the actual hardware.\nAlternatively, you can install one of the supported operating systems in a virtual machine."),(0,r.kt)("p",null,"Any kind of virtualization can be used, for example:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.docker.com/"},"Docker")," (covered by this guide)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"http://www.linux-kvm.org/page/Main_Page"},"KVM")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://linuxcontainers.org/"},"LXC"))),(0,r.kt)("p",null,"Please refer to the following documents to set up the operating systems and Gitian."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null}),(0,r.kt)("th",{parentName:"tr",align:null},"Ubuntu/Debian"),(0,r.kt)("th",{parentName:"tr",align:null},"Fedora/CentOS"),(0,r.kt)("th",{parentName:"tr",align:null},"Windows"),(0,r.kt)("th",{parentName:"tr",align:null},"macOS"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Setup Docker"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/docs/Pcoin-Core/Building/gitian-building/docker-setup-windows"},"Setup Docker for Windows")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/docs/Pcoin-Core/Building/gitian-building/docker-setup-mac"},"Setup Docker for macOS"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Setup WSL (windows only)"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/docs/Pcoin-Core/Building/gitian-building/wsl-setup-windows"},"Setup WSL for Windows")),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Setup Gitian"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/docs/Pcoin-Core/Building/gitian-building/gitian-setup-ubuntu"},"Setup Gitian on Ubuntu")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/docs/Pcoin-Core/Building/gitian-building/gitian-setup-fedora"},"Setup Gitian on Fedora")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/docs/Pcoin-Core/Building/gitian-building/gitian-setup-windows"},"Setup Gitian on Windows")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/docs/Pcoin-Core/Building/gitian-building/gitian-setup-mac"},"Setup Gitian on macOS"))))),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"Note for users wishing to use LXC: A version of ",(0,r.kt)("inlineCode",{parentName:"li"},"lxc-execute")," higher or equal to 2.1.1 is required."),(0,r.kt)("li",{parentName:"ul"},"You can check the version with ",(0,r.kt)("inlineCode",{parentName:"li"},"lxc-execute --version"),"."),(0,r.kt)("li",{parentName:"ul"},"On Debian you might have to compile a suitable version of lxc or you can use Ubuntu 18.04 or higher instead of Debian as the host."))),(0,r.kt)("h4",{id:"macos-builds"},"macOS Builds"),(0,r.kt)("p",null,"In order to build and sign for macOS, you need to download the free SDK and extract a file. The steps are described ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/pcoinproject/pcoin/tree/master/contrib/macdeploy#sdk-extraction"},"here"),". Alternatively, you can skip the macOS build by adding ",(0,r.kt)("inlineCode",{parentName:"p"},"--os=lw")," below."),(0,r.kt)("h2",{id:"initial-gitian-setup"},"Initial Gitian Setup"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"gitian-build.py")," script is designed to checkout different release tags, commits, branches, or pull requests. The linked guides above cover the process of obtaining the script and doing the basic initial setup."),(0,r.kt)("h2",{id:"building-pcoin-core"},"Building PCOIN Core"),(0,r.kt)("p",null,"The script allows you to build tags, commits, branches, and even pull requests. Below are some examples:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"To build the 3.3.0 release tag:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"export NAME=satoshi\nexport VERSION=3.3.0\n./gitian-build.py --docker -b $NAME $VERSION\n"))),(0,r.kt)("li",{parentName:"ul"},"To Build the master branch:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"export NAME=satoshi\nexport BRANCH=master\n./gitian-build.py --docker -b -c --detach-sign $NAME $BRANCH\n"))),(0,r.kt)("li",{parentName:"ul"},"To Build a specific commit:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"export NAME=satoshi\nexport COMMIT=2269f10fd91b9dbfba0ecc43e4558b7590e3805c\n./gitian-build.py --docker -b -c --detach-sign $NAME $COMMIT\n"))),(0,r.kt)("li",{parentName:"ul"},"To Build a pull request:\n",(0,r.kt)("inlineCode",{parentName:"li"},"bash export NAME=satoshi export PRNUM=949 ./gitian-build.py --docker -b -p --detach-sign $NAME $PRNUM "),"\nTo speed up the build, add ",(0,r.kt)("inlineCode",{parentName:"li"},"-j 6 -m 6000")," to the list of arguments, where ",(0,r.kt)("inlineCode",{parentName:"li"},"6")," is the number of CPU cores you wish to use (cannot exceed what is available), and 6000 is a little bit less than then the MB's of RAM you have.")),(0,r.kt)("p",null,"Note the use of the ",(0,r.kt)("inlineCode",{parentName:"p"},"--detach-sign")," option in the examples above, which allows you to sign the build results on a machine other than the gitian host. Only release tags have their signatures signed and committed to a public repository."),(0,r.kt)("p",null,"The build process results in a number of ",(0,r.kt)("inlineCode",{parentName:"p"},".assert")," files in your local gitian.sigs repository. Additionally, if you omit the ",(0,r.kt)("inlineCode",{parentName:"p"},"--detach-sign")," option, the script will attempt to sign and commit these files for you."),(0,r.kt)("h2",{id:"signing-externally"},"Signing Externally"),(0,r.kt)("p",null,"If your gitian host does not have your GPG private key installed, you will need to copy these uncommited changes to your host machine, where you can sign them:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"gpg --output ${VERSION}-linux/${NAME}/pcoin-linux-${VERSION%\\.*}-build.assert.sig --detach-sign ${VERSION}-linux/$NAME/pcoin-linux-${VERSION%\\.*}-build.assert\ngpg --output ${VERSION}-osx-unsigned/$NAME/pcoin-osx-${VERSION%\\.*}-build.assert.sig --detach-sign ${VERSION}-osx-unsigned/$NAME/pcoin-osx-${VERSION%\\.*}-build.assert\ngpg --output ${VERSION}-win-unsigned/$NAME/pcoin-win-${VERSION%\\.*}-build.assert.sig --detach-sign ${VERSION}-win-unsigned/$NAME/pcoin-win-${VERSION%\\.*}-build.assert\n")),(0,r.kt)("h2",{id:"uploading-signatures"},"Uploading Signatures"),(0,r.kt)("p",null,"Make a Pull Request (both the ",(0,r.kt)("inlineCode",{parentName:"p"},".assert")," and ",(0,r.kt)("inlineCode",{parentName:"p"},".assert.sig")," files) to the\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/pcoinproject/gitian.sigs/"},"gitian.sigs")," repository:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'git checkout -b ${VERSION}-not-codesigned\ngit commit -S -a -m "Add $NAME $VERSION non-code signed signatures"\ngit push --set-upstream $NAME $VERSION-not-codesigned\n')),(0,r.kt)("p",null,"You may have other .assert files as well (e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"signed")," ones), in which case you should sign them too. You can see all of them by doing ",(0,r.kt)("inlineCode",{parentName:"p"},"ls ${VERSION}-*/${NAME}"),"."),(0,r.kt)("p",null,"This will create the ",(0,r.kt)("inlineCode",{parentName:"p"},".sig")," files that can be committed together with the ",(0,r.kt)("inlineCode",{parentName:"p"},".assert")," files to assert your\nGitian build."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"./gitian-build.py --detach-sign -s $NAME $VERSION\n")),(0,r.kt)("p",null,"Make another pull request for these."))}g.isMDXComponent=!0}}]);